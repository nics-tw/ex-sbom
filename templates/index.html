<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ex-s</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@2.0.0"></script>
    <style>
      .tab-active {
        border-bottom: 2px solid #009999;
        background-color: rgba(0, 153, 153, 0.1);
      }
    </style>
  </head>
  <body>
    <header class="bg-white shadow">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between"
      >
        <div class="flex items-center space-x-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-7 w-7 text-[#009999]"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z"
              clip-rule="evenodd"
            />
          </svg>
          <h1 class="text-2xl font-bold text-gray-800 tracking-tight">ex-s</h1>
        </div>
        <div class="text-sm text-gray-600">
          SBOM Explorer, designed by NICS-ra
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex items-start">
        <div>
          <input
            type="file"
            id="sbom-file-input"
            class="hidden"
            multiple
            accept=".json,.xml,.spdx"
          />

          <button
            id="select-sbom-btn"
            class="select-btn bg-[#009999] hover:bg-[#19a3a3] text-white font-medium py-2 px-4 rounded-md shadow transition duration-200 flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
            onclick="document.getElementById('sbom-file-input').click()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
              />
            </svg>
            <span>Select SBOM Files</span>
          </button>
        </div>

        <!-- File list container -->
        <div id="selected-files" class="ml-6 mt-1 text-gray-700"></div>
      </div>

      <!-- Upload status container -->
      <div id="upload-status" class="mt-4"></div>

      <!-- Tabs container -->
      <div class="mt-6 border-b border-gray-200">
        <div class="text-lg font-medium text-gray-700 mb-2">
          Uploaded SBOM Files
        </div>
        <div id="file-tabs" class="flex flex-wrap"></div>
      </div>

      <!-- Tab content area -->
      <div id="tab-content" class="py-4">
        <div id="no-tabs-message" class="text-gray-500 italic">
          No files uploaded yet
        </div>
      </div>
    </div>

    <script>
      // Track uploaded files
      const uploadedFiles = new Set();
      let activeTab = null;

      document
        .getElementById("sbom-file-input")
        .addEventListener("change", async function (e) {
          // Existing file upload code remains the same
          const fileList = e.target.files;
          const selectedFilesContainer =
            document.getElementById("selected-files");
          const statusContainer = document.getElementById("upload-status");

          statusContainer.innerHTML = "";
          selectedFilesContainer.innerHTML = "";

          if (fileList.length > 0) {
            const fileListHeading = document.createElement("div");
            fileListHeading.className = "font-medium mb-2";
            fileListHeading.textContent = "Selected files:";
            selectedFilesContainer.appendChild(fileListHeading);

            const fileListElement = document.createElement("ul");
            fileListElement.className = "space-y-1";

            Array.from(fileList).forEach((file) => {
              const listItem = document.createElement("li");
              listItem.className = "flex items-center";

              const icon = document.createElement("span");
              icon.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-[#009999] mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
                </svg>
              `;

              const fileName = document.createElement("span");
              fileName.textContent = file.name;
              listItem.appendChild(icon);
              listItem.appendChild(fileName);
              fileListElement.appendChild(listItem);
            });

            selectedFilesContainer.appendChild(fileListElement);

            const statusList = document.createElement("ul");
            statusList.className = "space-y-2 mt-4";
            statusContainer.appendChild(statusList);

            const selectButton = document.getElementById("select-sbom-btn");
            selectButton.disabled = true;
            selectButton.classList.add("opacity-50", "cursor-not-allowed");

            for (const file of fileList) {
              const statusItem = document.createElement("li");
              statusItem.className = "flex items-center";
              statusItem.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                </svg>
                <span>Uploading ${file.name}...</span>
              `;
              statusList.appendChild(statusItem);

              // Check if we're overwriting an existing file
              const isOverwriting = uploadedFiles.has(file.name);

              // If overwriting, show the warning message
              if (isOverwriting) {
                const warningItem = document.createElement("li");
                warningItem.className =
                  "flex items-center bg-yellow-50 px-4 py-2 rounded-md border border-yellow-200 mt-2";
                warningItem.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
      </svg>
      <span class="text-yellow-800">Warning: the previous <strong>${file.name}</strong> will be overwritten since the file names are same.</span>
    `;
                statusList.appendChild(warningItem);

                // Remove the warning after 15 seconds
                setTimeout(() => {
                  warningItem.classList.add(
                    "transition-opacity",
                    "duration-500",
                    "opacity-0"
                  );
                  setTimeout(() => {
                    warningItem.remove();
                  }, 500);
                }, 15000);
              }

              try {
                const content = await readFileAsText(file);
                const response = await fetch(
                  "/sbom/upload?name=" + encodeURIComponent(file.name),
                  {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: content,
                  }
                );

                if (response.ok) {
                  // Get the response data which contains the file name
                  const responseData = await response.json();
                  const fileName = responseData.data?.name || file.name;

                  statusItem.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <span>${file.name} uploaded successfully</span>
                  `;

                  // Add a tab for the uploaded file
                  addFileTab(fileName);

                  // remove the uploading status after 3 seconds
                  setTimeout(() => {
                    statusItem.remove();
                  }, 3000);
                } else {
                  // Error handling remains the same
                  const errorData = await response.json();
                  statusItem.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-red-600">${file.name}: ${
                    errorData.error || "Upload failed"
                  }</span>
                  `;
                }
              } catch (error) {
                // Error reading or uploading file - same as before
                statusItem.innerHTML = `
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-red-600">${file.name}: ${
                  error.message || "Error reading file"
                }</span>
                `;
              }
            }

            // Re-enable select button after uploads
            selectButton.disabled = false;
            selectButton.classList.remove("opacity-50", "cursor-not-allowed");
          }
        });

      // Function to add a new file tab
      function addFileTab(fileName) {
        // If we already have this file, don't add it again
        if (uploadedFiles.has(fileName)) {
          return;
        }

        uploadedFiles.add(fileName);

        const tabsContainer = document.getElementById("file-tabs");
        const noTabsMessage = document.getElementById("no-tabs-message");

        // Hide the "no files" message
        if (noTabsMessage) {
          noTabsMessage.style.display = "none";
        }

        // Create the tab element
        const tab = document.createElement("div");
        tab.className =
          "px-4 py-2 border border-gray-300 rounded-t-md mr-2 mb-2 cursor-pointer hover:bg-gray-50 flex items-center";
        tab.dataset.fileName = fileName;

        // Tab content
        tab.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-[#009999] mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
          </svg>
          <span>${fileName}</span>
        `;

        // Add click event to select the tab
        tab.addEventListener("click", () => selectTab(tab));

        // Add the tab to the container
        tabsContainer.appendChild(tab);

        // Select this tab if it's the first one
        if (uploadedFiles.size === 1) {
          selectTab(tab);
        }
      }

      // Function to select a tab
      function selectTab(tabElement) {
        const tabsContainer = document.getElementById("file-tabs");
        const tabContent = document.getElementById("tab-content");
        const fileName = tabElement.dataset.fileName;

        // Remove active class from all tabs
        tabsContainer.querySelectorAll("div").forEach((tab) => {
          tab.classList.remove("tab-active");
        });

        // Add active class to selected tab
        tabElement.classList.add("tab-active");

        // Show loading state
        tabContent.innerHTML = `
    <div class="flex items-center justify-between mb-4">
      <div class="text-lg font-medium">${fileName}</div>
      <button 
        class="delete-btn bg-[#E46058] hover:bg-red-600 text-white py-1 px-3 rounded text-sm flex items-center"
        onclick="deleteFile('${fileName}')"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        Delete
      </button>
    </div>
    <div class="mt-4 text-gray-600 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="animate-spin h-5 w-5 mr-3 text-[#009999]" viewBox="0 0 24 24" fill="none">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Loading topology data...
    </div>
  `;

        // Store the active tab
        activeTab = tabElement;

        // Fetch topology data
        fetchTopologyData(fileName);
      }

      // Add a new function to fetch topology data
      async function fetchTopologyData(fileName) {
        try {
          const response = await fetch(
            `/topology/get_list_by_level?name=${encodeURIComponent(fileName)}`
          );

          if (!response.ok) {
            throw new Error(`Failed to fetch topology: ${response.status}`);
          }

          const responseData = await response.json();

          if (responseData.data) {
            displayTopologyData(responseData.data, fileName);
          } else {
            throw new Error("No topology data available");
          }
        } catch (error) {
          console.error("Error fetching topology:", error);

          const tabContent = document.getElementById("tab-content");
          const headerDiv = tabContent.querySelector("div:first-child");

          // Keep the header with delete button
          tabContent.innerHTML = "";
          tabContent.appendChild(headerDiv);

          // Show error message
          const errorDiv = document.createElement("div");
          errorDiv.className = "mt-4 p-4 bg-red-50 text-red-600 rounded-md";
          errorDiv.innerHTML = `
      <div class="font-medium">Failed to load topology data</div>
      <div class="text-sm mt-1">${
        error.message || "Unknown error occurred"
      }</div>
    `;
          tabContent.appendChild(errorDiv);
        }
      }

      // Function to display topology data
      function displayTopologyData(topologyData, fileName) {
        const tabContent = document.getElementById("tab-content");
        const headerDiv = tabContent.querySelector("div:first-child");

        // Keep the header with delete button
        tabContent.innerHTML = "";
        tabContent.appendChild(headerDiv);

        // Create container for topology data
        const topologyContainer = document.createElement("div");
        topologyContainer.className = "mt-6";

        // Sort levels by level number
        const sortedLevels = topologyData.sort((a, b) => a.level - b.level);

        if (sortedLevels.length === 0) {
          const emptyState = document.createElement("div");
          emptyState.className = "text-gray-500 italic";
          emptyState.textContent = "No topology data available for this SBOM";
          topologyContainer.appendChild(emptyState);
        } else {
          // Create level panels
          sortedLevels.forEach((level) => {
            const levelPanel = document.createElement("div");
            levelPanel.className =
              "mb-6 border border-gray-200 rounded-md overflow-hidden";

            // Level header
            const levelHeader = document.createElement("div");
            levelHeader.className =
              "bg-gray-50 px-4 py-3 flex items-center justify-between cursor-pointer";

            // Add click event for folding/unfolding
            const componentCount = level.components.length;
            const hasLotsOfComponents = componentCount > 20;

            const levelTitle = document.createElement("div");
            levelTitle.className = "font-medium";
            levelTitle.innerHTML =
              level.level === 0
                ? `Root Level <span class="text-sm font-normal text-gray-500">(Top-level dependencies, which is directly import as package/component)</span>`
                : `Level ${level.level} <span class="text-sm font-normal text-gray-500">(${componentCount} components)</span>`;

            const rightSection = document.createElement("div");
            rightSection.className = "flex items-center space-x-2";

            const vulnBadge = document.createElement("div");
            if (level.total_vulns > 0) {
              vulnBadge.className =
                "px-2 py-1 text-xs font-medium bg-[#D9936E] text-red-800 rounded-full";
              vulnBadge.textContent = `${level.total_vulns} vulnerabilities`;
            } else {
              vulnBadge.className =
                "px-2 py-1 text-xs font-medium bg-[#95D0C0] text-[#231815] rounded-full";
              vulnBadge.textContent = "No vulnerabilities";
            }

            // Fold/Unfold icon
            const foldIcon = document.createElement("span");
            foldIcon.className = "text-gray-500";
            foldIcon.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      `;

            rightSection.appendChild(vulnBadge);
            rightSection.appendChild(foldIcon);

            levelHeader.appendChild(levelTitle);
            levelHeader.appendChild(rightSection);
            levelPanel.appendChild(levelHeader);

            // Components list container
            const componentsList = document.createElement("div");
            componentsList.className = "px-4 py-3";
            componentsList.dataset.isExpanded = "true";

            if (componentCount === 0) {
              componentsList.innerHTML =
                "<div class='text-gray-500 italic'>No components at this level</div>";
            } else {
              const componentsGrid = document.createElement("div");
              componentsGrid.className =
                "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2";

              // Function to render components
              const renderComponents = (showAll) => {
                componentsGrid.innerHTML = "";
                const displayComponents = showAll
                  ? level.components
                  : level.components.slice(0, 10);

                displayComponents.forEach((component) => {
                  const componentItem = document.createElement("div");
                  const hasVuln =
                    level.components_with_vuln.includes(component);

                  componentItem.className = hasVuln
                    ? "px-3 py-2 border border-red-200 bg-red-50 rounded flex items-center"
                    : "px-3 py-2 border border-gray-200 bg-white rounded flex items-center";

                  const icon = hasVuln
                    ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500 mr-2 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 mr-2 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd" />
                </svg>`;

                  componentItem.innerHTML = `${icon}<span class="truncate">${component}</span>`;
                  componentsGrid.appendChild(componentItem);
                });

                // Add "Show more" / "Show less" button if needed
                if (hasLotsOfComponents) {
                  const toggleButton = document.createElement("button");
                  toggleButton.className =
                    "mt-4 text-sm text-[#009999] hover:text-[#CCCC00] font-medium flex items-center";

                  if (showAll) {
                    toggleButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                Show less
              `;
                    toggleButton.onclick = () => renderComponents(false);
                  } else {
                    toggleButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Show all ${componentCount} components
              `;
                    toggleButton.onclick = () => renderComponents(true);
                  }

                  componentsGrid.appendChild(toggleButton);
                }
              };

              // Initial rendering
              renderComponents(false);
              componentsList.appendChild(componentsGrid);
            }

            // Add click event to toggle visibility
            levelHeader.addEventListener("click", () => {
              const isExpanded = componentsList.dataset.isExpanded === "true";

              // Toggle visibility
              if (isExpanded) {
                componentsList.style.display = "none";
                componentsList.dataset.isExpanded = "false";
                foldIcon.querySelector("svg").classList.add("-rotate-90");
              } else {
                componentsList.style.display = "block";
                componentsList.dataset.isExpanded = "true";
                foldIcon.querySelector("svg").classList.remove("-rotate-90");
              }
            });

            levelPanel.appendChild(componentsList);
            topologyContainer.appendChild(levelPanel);
          });
        }

        tabContent.appendChild(topologyContainer);
      }

      // Function to delete a file
      async function deleteFile(fileName) {
        try {
          const response = await fetch(
            `/sbom/delete?name=${encodeURIComponent(fileName)}`,
            {
              method: "DELETE",
            }
          );

          if (response.ok) {
            // Remove the tab
            const tabsContainer = document.getElementById("file-tabs");
            const tabToRemove = tabsContainer.querySelector(
              `[data-file-name="${fileName}"]`
            );

            if (tabToRemove) {
              tabsContainer.removeChild(tabToRemove);
              uploadedFiles.delete(fileName);

              // Clear content if this was the active tab
              if (activeTab === tabToRemove) {
                document.getElementById("tab-content").innerHTML = "";
                activeTab = null;
              }

              // If there are other tabs, select the first one
              if (uploadedFiles.size > 0) {
                const firstTab = tabsContainer.querySelector("div");
                if (firstTab) {
                  selectTab(firstTab);
                }
              } else {
                // Show "no files" message
                document.getElementById("tab-content").innerHTML =
                  '<div id="no-tabs-message" class="text-gray-500 italic">No files uploaded yet</div>';
              }
            }

            // Reset file input to allow re-uploading the same file
            document.getElementById("sbom-file-input").value = "";

            // Show success message
            const statusContainer = document.getElementById("upload-status");
            const successMessage = document.createElement("div");
            successMessage.className = "mt-2 text-green-600 flex items-center";
            successMessage.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              ${fileName} deleted successfully
            `;
            statusContainer.innerHTML = "";
            statusContainer.appendChild(successMessage);

            // Remove the message after 3 seconds
            setTimeout(() => {
              successMessage.remove();
            }, 3000);
          } else {
            // Handle error
            const errorData = await response.json();
            alert(`Error deleting file: ${errorData.error || "Unknown error"}`);
          }
        } catch (error) {
          console.error("Error deleting file:", error);
          alert(`Failed to delete file: ${error.message || "Network error"}`);
        }
      }

      // Helper function to read file as text (keep the existing one)
      function readFileAsText(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(new Error("Error reading file"));
          reader.readAsText(file);
        });
      }
    </script>
  </body>
</html>
